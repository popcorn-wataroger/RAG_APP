FROM python:3.11-slim

# ------------------------------------------------------------
# 1) 作業ディレクトリ
# ------------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------------
# 2) 依存を先に入れる（キャッシュが効く）
# ------------------------------------------------------------
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ------------------------------------------------------------
# 3) アプリ本体をコピー
# ------------------------------------------------------------
COPY . .

# ------------------------------------------------------------
# 4) Cloud Run のポート
# ------------------------------------------------------------
ENV PORT=8080

# ------------------------------------------------------------
# 5) FastAPI 起動（app.py の中の app を起動）
# ------------------------------------------------------------
CMD ["sh", "-c", "uvicorn app:app --host 0.0.0.0 --port ${PORT}"]
